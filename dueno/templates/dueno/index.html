{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel Propietario</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link rel="shortcut icon" href="{% static 'img/icono-base.png' %}" type="image/x-icon">
  <link rel="shortcut icon" href="{% static 'img/icono' %}" type="image/x-icon">
</head>
<body class="bg-light">
<div class="mini-bar" >
    |
    <div class="item-izquierda"><span class="label">D√≥lar (En Peso CLP) :</span> ${{ clp }}</div>
    |
    <div class="item-izquierda"><span class="label">Euro (En Peso CLP) :</span> ${{ euro }}</div>
    |
    <div class="item-derecha"><span class="label">UF (En Peso CLP) :</span> ${{ uf }}</div>
    |
    <div class="item-derecha"><span class="label">IVA Chile :</span> {{ iva }}%</div>
</div>
<br>
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!-- navbar superior -->
<nav style="border-color: rgba(222, 125, 46, 0) !important; background: linear-gradient(to right, rgba(222, 125, 46, 0.79), rgba(201, 134, 72, 0.36)) !important;" class="navbar navbar-light bg-white border-bottom px-4 py-2 d-flex justify-content-between align-items-center w-100">
  <button style=" background: #ffffffa3; !important" class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Mostrar men√∫">
    <i class="bi bi-list"></i>
  </button>

  <div id="div-Banner">
    <br>
    <a class="navbar-brand fw-bold" href="{% url 'index_administrador' %}" style="margin-left: 25px;">
      <img class="navbar-img" src="{% static 'img/1-PNG.png' %}" alt="PropiedadesWeb" />
      <br>
    </a>
  </div>

   <div class="dropdown">
    <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      <img src="https://avatars.githubusercontent.com/u/1?v=4" alt="Perfil" width="35" height="35" class="rounded-circle border border-2" />
    </a>
    <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown">
      <div style="margin: 10px 22px;">
 {% if dueno %}
  <p><strong>Usuario:</strong> {{ dueno.user.username }}</p>
  <p><strong>Tel√©fono:</strong> {{ dueno.telefono }} </p>
  <p><strong>Rut: </strong>{{ dueno.rut }} </p>
{% else %}
  <p>No tienes un perfil asociado.</p>
{% endif %}
      </div>
      <li><a class="dropdown-item" href="{% url 'actualizar_cli' request.user.id %}">Editar Perfil</a></li>
      <li><hr class="dropdown-divider" /></li>
      <li>
        <form method="POST" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit" class="dropdown-item"><i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesi√≥n</button>
        </form>
      </li>
    </ul>
  </div>
</nav>
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->


<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<!-- Contenedor principal - contenido -->
<div class="container-fluid">
  <div class="row">
   <div style="border-color: rgba(222, 125, 46, 0) !important; background: linear-gradient(to right, rgba(222, 125, 46, 0.79), rgba(201, 134, 72, 0.77)) !important" class="col-md-3 col-lg-2 collapse show bg-white border-end p-3 min-vh-100" id="sidebar">
<div>
      <h4 class=" h-100 p-5 text-white bg-dark rounded-3" style="text-align: center !important;">       
 {% if dueno %}
  <p><strong>Usuario:</strong> {{ dueno.user.username }}</p>
  <p><strong>Tel√©fono:</strong> {{ dueno.telefono }} </p>
  <p><strong>Rut: </strong>{{ dueno.rut }} </p>
{% else %}
  <p>No tienes un perfil asociado.</p>
{% endif %}
      </h4>       
</div>
      <ul class="nav nav-pills flex-column mb-auto ">
        <li class="nav-item">
           <br>
          <a href="{% url 'dueno_index' %}" class="text-center h-100 p-3 text-white bg-dark rounded-3 nav-link text-dark">
            <i class="bi bi-speedometer2 me-2"></i> Menu Principal
          </a>
        </li>
        <li class="nav-item">
           <br>
          <a href="{% url 'listar_propiedad' %}" class="text-center h-100 p-3 text-white bg-dark rounded-3 nav-link text-dark">
            <i class="bi bi-plus-square me-2"></i> Mis Propiedades
          </a>
        </li>
        <li class="nav-item">
           <br>
          <a href="#" class="text-center h-100 p-3 text-white bg-dark rounded-3 nav-link text-dark">
            <i class="bi bi-chat-left-text me-2"></i> Ver Ofertas
          </a>
        </li>
        <br>
          <a href="{% url 'crear_propiedad' %}" class="text-center h-100 p-3 text-white bg-dark rounded-3 nav-link text-dark">
            <i class="bi bi-chat-left-text me-2"></i> Cargar Propiedad
          </a>
        </li>
        <br>
        <li class="nav-item">
           <br>
          <a href="#" type="submit" class="text-center h-100 p-3 text-white bg-dark rounded-3 nav-link text-dark">
                    <form method="POST" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit" class="dropdown-item"><i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesi√≥n</button>
        </form>
          </a>
        </li>
      </ul>
    </div>
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
 


<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
    <!-- Contenido principal -->
    <main class="col-md-9 col-lg-10 py-4">
      <br>
      <div class="container mt-12">


        <!-- Tabla de Propiedades -->
        <h2 style="font-size: larger !important;" class=" p-4 text-white bg-dark rounded-4 nav-link text-dark">üèòÔ∏è Tus Propiedades Listadas:</h2>
      
<main class="col-md-9 col-lg-10 px-md-4 py-4 overflow-auto min-vh-100">
{% block content %}
<section>
  <div class="row g-4">
    {% if propiedades %}
      {% for propiedad in propiedades %}
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm border-0">
            {% if propiedad.imagenes.first %}
              <img src="{{ propiedad.imagenes.first.imagen.url }}" 
                   class="card-img-top" 
                   alt="{{ propiedad.titulo }}" 
                   style="height: 200px; object-fit: cover;">
            {% else %}
              <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height: 200px;">
                <p class="mb-0">Sin imagen</p>
              </div>
            {% endif %}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ propiedad.titulo }}</h5>
              <p class="card-text text-muted mb-1"><strong>Valor:</strong> ${{ propiedad.valor|floatformat:0 }}</p>
              <p class="card-text">{{ propiedad.descripcion|truncatechars:80 }}</p>
              <a href="{% url 'detalle_propiedad' propiedad.id %}" class="btn btn-primary mt-auto rounded-pill">Ver m√°s</a>
              <div class="p-4 text-white rounded-4 nav-link text-dark mt-3">
                <p class="card-text text-muted"><strong>Estado:</strong> {{ propiedad.estado }}</p>
                <p class="card-text text-muted"><strong>Publicaci√≥n:</strong> {{ propiedad.fecha_publicacion|date:"d M Y" }}</p>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="col-12">
        <p class="text-white">No hay propiedades disponibles.</p>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}


<br>


    <div class="p-4 p-md-5 mb-4 rounded text-bg-dark">
      <div class="col-md-6 px-0">
{% if propiedadesPropietario %}
    <div class="propiedades-lista">
        {% for propiedad in propiedadesPropietario %}
            <div class="propiedad-card">
                <h3>{{ propiedad.titulo }}</h3>

                {% if propiedad.imagen %}
                    <img src="{{ propiedad.imagen.url }}" alt="Imagen de {{ propiedad.titulo }}" width="300">
                {% endif %}

                <p><strong>Direcci√≥n:</strong> {{ propiedad.direccion }}</p>
                <p><strong>Precio:</strong> ${{ propiedad.valor|floatformat:0 }}</p>
                <p><strong>Visibilidad:</strong> {{ propiedad.visibilidad }}</p>
                <p><strong>Estado:</strong> {% if propiedad.activo %}Activa{% else %}Inactiva{% endif %}</p>
                <a href="{% url 'detalle_propiedad' propiedad.id %}" class="btn btn-primary">Ver Detalles</a>
            </div>
            <hr>
        {% endfor %}
    </div>
{% else %}
    <p>No tienes propiedades registradas a√∫n.</p>
{% endif %}

      </div>
    </div>
</main>


<style>.card {
  background-color: rgba(255, 255, 255, 0.9);
}
body.bg-dark .card {
  background-color: rgba(30, 30, 30, 0.85);
  color: #fff;
}</style>

</div>



<footer style="color: rgb(47, 47, 47) !important; border-color: rgba(222, 125, 46, 0) !important; background: linear-gradient(to right, rgba(222, 125, 46, 0.79), rgba(201, 134, 72, 0.36)) !important;" class="text-center text-muted small py-3">
<h5>¬© 2025 PropiedadesWeb.cl - v1.0</h5>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Bot√≥n WhatsApp -->
<a href="https://wa.me/56911111111" class="whatsapp-float" target="_blank" title="Hola Un Gusto!!, Bienvenidos a WSP PropiedadesWeb">
  <img src="{% static 'img/WhatsApp.svg' %}" alt="WhatsApp" />
</a>

<!-- Bot√≥n modo oscuro -->
<button class="btn btn-dark modo-btn" onclick="toggleModo()" id="modo-btn" aria-label="Cambiar modo">
  <i class="bi bi-moon-stars" id="icono-modo"></i>
</button>



<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<script>
  function toggleModo() {
    const body = document.body;
    const icono = document.getElementById("icono-modo");
    const btn = document.getElementById("modo-btn");

    if (body.classList.contains("bg-light")) {
      body.classList.replace("bg-light", "bg-dark");
      body.classList.add("text-white");
      icono.classList.replace("bi-moon-stars", "bi-sun");
      btn.classList.replace("btn-dark", "btn-light");
    } else {
      body.classList.replace("bg-dark", "bg-light");
      body.classList.remove("text-white");
      icono.classList.replace("bi-sun", "bi-moon-stars");
      btn.classList.replace("btn-light", "btn-dark");
    }
  }


  const listaMensajes = document.getElementById("lista-mensajes");
  listaMensajes.innerHTML = "";

  if (mensajes.length === 0) {
    listaMensajes.innerHTML = '<li class="list-group-item">No hay mensajes recientes.</li>';
  } else {
    mensajes.forEach(({cliente, correo, telefono, mensaje}) => {
      const li = document.createElement("li");
      li.className = "list-group-item";
      li.innerHTML = `
        <strong>${cliente}</strong><br />
        <em>${mensaje}</em>
        <div class="detalle-contacto">
          Correo: <a href="mailto:${correo}">${correo}</a> | Tel: <a href="tel:${telefono}">${telefono}</a>
        </div>
      `;
      listaMensajes.appendChild(li);
    });
  }

  const listaPropiedades = document.getElementById('total-propiedades-tipo');
  for (const [tipo, cantidad] of Object.entries(propiedadesPorTipo)) {
    const li = [...listaPropiedades.children].find(li => li.textContent.includes(tipo));
    if (li) {
      li.querySelector('span').textContent = cantidad;
    }
  }


</script>
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->


<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
<style>
  .detalle-contacto {
    background-color: #f8f9fa;
    padding: 6px 10px;
    margin-top: 8px;
    border-left: 4px solid #0d6efd;
    font-size: 0.9rem;
    color: #495057;
  }

   .modo-btn {
    position: fixed;
    bottom: 20px;
    right: 100px;
    z-index: 9999;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  }

  .whatsapp-float {
    position: fixed;
    width: 60px;
    height: 60px;
    bottom: 20px;
    right: 20px;
    background-color: #25D366;
    color: white;
    border-radius: 50%;
    text-align: center;
    font-size: 30px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
  }

  .whatsapp-float:hover {
    transform: scale(1.1);
    background-color: #1ebc59;
  }

  .whatsapp-float img {
    width: 28px;
    height: 28px;
  }

          body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .mini-bar {
            background-color:rgb(0, 0, 0);
            color: white;
            font-size: 0.9rem;
            display: flex;
            justify-content: end;
            gap: 20px;
            padding: 5px 10px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 999;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .label {
            font-weight: bold;
        }
</style>
<!--////////////////////////////////////////////////////////////////////////////////////////////////////////////-->


</body>
</html>

